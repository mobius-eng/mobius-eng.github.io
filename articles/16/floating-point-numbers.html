<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Practical and theoretical numbers</title>
  <meta name="description" content="IntroductionMathematicians operate on numbers  for which we do not haveproper representations. Consider, for example, number ​ or​: we cannot write full frac...">


  <link rel="stylesheet" href="/css/tufte.css">	
  

  <!-- Google Fonts loaded here depending on setting in _data/options.yml true loads font, blank does not-->
  
    <link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
  
  <!-- Load up MathJax script if needed ... specify in /_data/options.yml file-->
  
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

  <link rel="canonical" href="/articles/16/floating-point-numbers">
  <link rel="alternate" type="application/rss+xml" title="MobiusEng: Math Science Engineering" href="/feed.xml" />
</head>

  <body>
    <!--- Header and nav template site-wide -->
<header>
    <nav class="group">
	<a href="/"><img class="badge" src="/assets/img/badge_1.png" alt="CH"></a>
	
		
  	
		
		    
		      <a href="/">blog</a>
		    
	    
  	
		
		    
		      <a href="/about/">About</a>
		    
	    
  	
		
  	
	</nav>
</header>
    <article class="group">
      <h1>Practical and theoretical numbers</h1>
<p class="subtitle">March 29, 2016</p>


<h2 id="introduction">Introduction</h2>

<p><span class="newthought">Mathematicians operate on numbers</span>  for which we do not have
proper representations. Consider, for example, number <span>​<script type="math/tex">\pi </script></span> or
<span>​<script type="math/tex">\sqrt{2}</script></span>: we cannot write full fractional representation of any
of them. Furthermore, let <span>​<script type="math/tex">k = \pi / \sqrt{2}</script></span>; we cannot write
neither fractional representation of <script type="math/tex">k</script>, nor it could be represented via
either <span>​<script type="math/tex">\sqrt{2}</script></span> or <span>​<script type="math/tex">\pi</script></span>. We will call such numbers
<em>theoretical</em>.</p>

<p>In contrast, <em>practical</em> numbers are those we can actually use for
calculations<label for="one" class="margin-toggle sidenote-number"></label><input type="checkbox" id="one" class="margin-toggle" /><span class="sidenote">Hamming in his book use word <em>real</em> numbers,
but that may create confusion with numbers from set <script type="math/tex">\mathbb{R}</script> </span>.
There are numerous ways how we can define these practical numbers: they can be
just usual decimals or binaries, or, perhaps, something more esoteric
as having numbers such as</p>

<div class="mathblock"><script type="math/tex; mode=display"> x = \sum_{i=-A}^{+B} x_i \sqrt{2^i} </script></div>

<p>for some positive values <span>​<script type="math/tex">A</script></span> and <span>​<script type="math/tex">B</script></span>. Of course,
since we want numbers to be practical, we’ll need to settle on something less
idiosyncratic.</p>

<p>Since we are going to use a computational machine (computer), it makes
sense to look at numbers as they are represented there. For
illustration purposes we will make a couple of changes. First, we will use
decimal notation instead of binary, as it is more familiar to most people.
Secondly, the number of digits to represent the number will be limited.</p>

<h2 id="intergers-and-fixed-point-numbers">Intergers and fixed-point numbers</h2>

<p><span class="newthought">Without going into too deep details</span>  about <em>integers</em>, we will
essentially equate a theoretical integer and a practical
integer. While in some systems (for example, C or Fortran) integers
might be capped to some value, most modern systems (Lisp, Python,
Smalltalk, F#, Haskell, etc.) offer arbitrary large integers (still
capped by the size of the available memory, but large enough for us
not to worry): 12356, -4567, 572168632689567.</p>

<p><em>Fixed-point</em> numbers are essentially the same as integers, but with the
decimal point put in the middle (usually, considering last four digits
to be fractional part of a number): 1235.600, -45.6700,
57216863268.9567. The point does not move, thus the smallest positive
number would be 0.001<label for="mn-electron" class="margin-toggle sidenote-number"></label><input type="checkbox" id="mn-electron" class="margin-toggle" /><span class="sidenote">This is way too large, for
example, to represent the mass of an electron, <script type="math/tex">9.11\times10^{-31}</script> kg </span>.
As integers, these numbers can be arbitrary large. However, the representation
of something as large as the mass of Earth<label for="sn-earth" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-earth" class="margin-toggle" /><span class="sidenote"><script type="math/tex">5.97\times10^{24}</script> kg </span> would lead to prohibitively slow arithmetic
operations. One area where fixed-point fractional numbers are successfully used
is the finance: the number representation guarantees that no money can be
made out of thin air, neither the money can disappear there (when
people do make such things, they have to use different methods).</p>

<h2 id="floating-point-numbers">Floating-point numbers</h2>

<p><span class="newthought">Engineers and scientists</span>  have to rely on <em>floating-point</em>
numbers for their calculations. First, floating-point numbers cover a large range
of values<label for="sn-float-range" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-float-range" class="margin-toggle" /><span class="sidenote">On modern personal computers they range
from about <script type="math/tex">10^{-300}</script> to <script type="math/tex">10^{300}</script> for both positive and negative
numbers </span> enabling to use them from quantum mechanics to statistical physics
and cosmology. Secondly, the operations on these numbers are relatively fast:
while they are slower than on (capped) integers, they are much faster compared
to arbitrary large integers or fixed-point numbers. As a trade off,
floating-pont numbers offer only limited precision. For example, number
<span>​<script type="math/tex">\pi</script></span> (which is irrational and hence has infinitely long tail
of digits without cycles) would be approximated by
<span>​<script type="math/tex">3.141592653589793</script></span> and the tail of <script type="math/tex">238462643383279\ldots</script> is
dropped.</p>

<p>Representation of floating-points numbers is close to a scientific notation.
For example, Avogadro’s number <script type="math/tex">N_A = 6.022\times10^{23}</script> will have the
following representation:</p>

<div class="mathblock"><script type="math/tex; mode=display">
+0.6022\times10^{24}.
</script></div>

<p>Here 0.6022 is <em>mantissa</em> (also referred as significand) and 23 is <em>exponent</em>.
For illustration purposes, following Hamming, we will limit mantissa to three
digits after the point and exponent to be in the range <script type="math/tex">-9</script> to
<script type="math/tex">9</script>. Notice leading 0 before the point: this is done for convenience so that
we can operate directly on fractional part of number. Also notice that the same
number can have a different representation:</p>

<div class="mathblock"><script type="math/tex; mode=display">
+0.06022\times10^{25}.
</script></div>

<p>Numbers for which the fractional part of mantissa starts with zero are called
<em>subnormal</em> numbers. We will follow the convention of most computer systems by
not allowing subnormal numbers. Thus, fractional part of mantissa must begin
with a non-zero digit.</p>

<p>There is no need to store leading zero or base 10 of the
representation. But we do need to make a provision for the sign of the
number<label for="sn-exp-sing" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-exp-sing" class="margin-toggle" /><span class="sidenote">Strictly speaking we need to take care of the
sign of the exponent as well. However, actual way of storing the exponent avoids
this problem, but we will omit this detail </span>. For example, the approximation of
number <script type="math/tex">\pi</script> can written as:</p>

<div class="mathblock"><script type="math/tex; mode=display">
0.3141592653589793 \times 10^1 = (+,3141592653589793,1)
</script></div>

<p>To keep the notation simple and not allow ourselves to be distracted by
unimportant details we will limit mantissa to contain only three digits and
exponent to fall in range <script type="math/tex">-9</script> to <script type="math/tex">9</script>.</p>

<p>If a number requires exponent to be higher (or lower) the limit, we encounter
<em>exponent overflow</em> (<em>underflow</em>). In computer systems we have two options: we
either signal an error (<em>raise an exception</em> using the terms of most modern
programming languages) and let the user decide what to do or we can silently
assign an <em>infinity</em> value (or zero in case of underflow). While the latter
might not be the best option from system design point of view, most of the
systems implement it due to its low computational cost and the fact that it
produces sensible (in practical terms) results. Negative and positive
infinities, will be <script type="math/tex">\pm\infty = (\pm, 999, 9)</script>. Thus, the largest (by
magnitude) proper number is <script type="math/tex">(+,998,9)</script>.</p>

<p>To represent number zero we will require that both mantissa and exponent of the
number are zero: <script type="math/tex">(\pm,000,0)</script>. Notice, we can have positive and negative
zeros. We will require that they are arithmetically equivalent.</p>

<p>Before looking into operations on floating-point numbers it’s worth
understanding some of their properties. First, there exists the
smallest positive floating-point number: <script type="math/tex">(+,100, -9)=0.1\times10^{-9}</script>.
Between <script type="math/tex">0.1\times10^{-9}</script> (including) and
<script type="math/tex">0.1\times10^{-8}</script> (excluding) there are exactly 900 numbers (with
mantissas ranging from 100 to 999). These numbers are uniformly distributed with
the interval <script type="math/tex">10^{-12}</script>. However, numbers in interval <script type="math/tex">0.1\times10^{-8}</script>
(including) and <script type="math/tex">0.1\times^{-7}</script> (excluding) are uniformly distributed with
the interval 10 times larger, <script type="math/tex">10^{-11}</script>. Continuing this process, one
concludes that 899 numbers in the interval <script type="math/tex">0.1\times^{9}</script> (including) to
<script type="math/tex">0.999\times{9}</script> (excluding) are distributed with the interval <script type="math/tex">10^{6}</script>.
However, floating-point numbers as whole are not uniformly distributed.</p>

<p>There is one case in which subnormal numbers can be sensibly allowed: consider
the following number close to zero, <script type="math/tex">(+,001, -9)</script>. It is hundred times smaller
than a proper smallest number. However, it only has one digit of precision. To
keep our discussion simple we will not allow even these subnormal numbers.</p>

<h2 id="arithmetic-on-floating-point-numbers">Arithmetic on floating-point numbers</h2>

<p>Let’s consider the addition of <script type="math/tex">0.360</script> and <script type="math/tex">12.5</script>:</p>

<div class="mathblock"><script type="math/tex; mode=display">
(+,360, 0) + (+,125,2)
</script></div>

<p>To add them we need to equate their exponents
first (by extending one of the mantissas):</p>

<div class="mathblock"><script type="math/tex; mode=display">
(+,360,0) + (+,125,2) = (+,00360,2) + (+,125,2)
= (+,12860, 2)
</script></div>

<p>Now we have the excess of digits in mantissa: last two digits need to be
dropped. There are two possible ways of dropping: either just truncate
them, or round them, in which case the last significant digit might
increase if the following digit is <script type="math/tex">\geq 5</script>. Simple truncation,
although faster, leads to a higher rate of precision loss. Considering
our low starting precision, we will use rounding. Thus the final
result becomes:</p>

<div class="mathblock"><script type="math/tex; mode=display">
(+,129, 2) = 12.9
</script></div>

<p>Another caveat of the addition is <em>mantissa overflow</em>. Consider, the following
example:</p>

<div class="mathblock"><script type="math/tex; mode=display">
4.0 + 7.0 = (+,400,10 1) + (+,700, 1) = (+,1'100, 1)
</script></div>

<p>Here mantissa became too large (notice, not just too long due to too high
precision required, but actually too large): now it represents number 1.100,
i.e. there is one <em>before</em> the point. This overflow needs to be consumed by the
exponent:</p>

<div class="mathblock"><script type="math/tex; mode=display">
(+,1'100, 1) = (+, 110, 2)
</script></div>

<p>Obviously, if two numbers are very large, their sum might exceed
the largest possible number in which case their result will become infinite:</p>

<div class="mathblock"><script type="math/tex; mode=display">
(+,700,9) + (+,600,9) = (+,999,9) = +\infty
</script></div>

<p>Multiplication is performed similarly, but exponents are added and the
mantissas are multiplied<label for="sn-man-mul" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-man-mul" class="margin-toggle" /><span class="sidenote">Notice we need to take care of
the fact that mantissas are fractional parts. For example in multiplication
<script type="math/tex">0.2\times0.3=0.06</script> mantissa terms will multiply as <script type="math/tex">200\times300=60000</script>.
This result needs to be adjusted by dividing it by <script type="math/tex">10^{3}</script>, i.e. 10 raised to
the power of mantissa width. </span>:</p>

<div class="mathblock"><script type="math/tex; mode=display">
\begin{align*}
4.0\times 50.0 = (+,400,10 1) \times (+,500,2) & = (+,200000, 1+2-3)\\
& = (+, 200, 3) = 200.0
\end{align*}
</script></div>

<p>We allow in our calculations to produce a technical mantissa overflow. However,
strictly speaking, the overflow is not possible as we multiply two numbers less
than one. Mantissa underflow, however, is possible in principle:</p>

<div class="mathblock"><script type="math/tex; mode=display">
3.0\times 20.0 = (+,300,1) \times (+,200,2) = (+, 060,3) = (+, 600, 2) = 60.0.
</script></div>

<p>Once again, the exponent is used to promote the first non-zero digit in mantissa
to the first position. Furthermore, the underflow of
multiplication of two very small numbers can lead to the zero result:</p>

<div class="mathblock"><script type="math/tex; mode=display">
(+,200,-8)\times(+,500,-9) = (+,000,0)
</script></div>

<p>Subtraction is very similar to addition, but it contains a subtle
danger. Consider the following expression:</p>

<div class="mathblock"><script type="math/tex; mode=display">
1.0 - 0.999 = (+,100,1) - (+,999,0) = (+,0001,1) = (+,100,-2) = 0.001
</script></div>

<p>Notice what has happened: we subtracted two numbers with the precision
of up to three digits, but the result has a precision of only one
digit. This is called <em>loss of significance</em>.</p>

<p>Floating-point numbers division is similar to multiplication, except
that exponents are subtracted and mantissas are divided. The caveat
with division is when a number is divided by a very small number
(similar to multiplication by a very large number): since the
magnitude increases significantly, the roundoff error is blown up as
well. The worst case scenario is when the significance is lost due to
subtraction and then this number is divided by something very
small. Consider, for example, approximating the derivative by finite
difference:</p>

<div class="mathblock"><script type="math/tex; mode=display">
D[f](x) = \frac{df}{dx}(x) = \frac{f(x+h) - f(x-h)}{2h} +O(h^2)
</script></div>

<p>Operated on theoretical numbers, this approximation should reduce the
error quadratically as <script type="math/tex">h</script> gets smaller. Unfortunately, to see this effect
three digits in mantissa is not enough: for this example mantissa is extended to
six digits. To be practical, let’s consider function <script type="math/tex">y=\exp{x}</script>. The
derivative of this function at <script type="math/tex">x=0</script> is known, <script type="math/tex">D[\exp{}](0) = 1</script>. Thus,
the difference</p>

<div class="mathblock"><script type="math/tex; mode=display">
\Delta = \frac{\exp{h} - \exp{(-h)}}{2h} - 1
</script></div>

<p>measures the overall error of derivative approximation at <script type="math/tex">x=0</script>. First, if
<script type="math/tex">h</script> is taken as <script type="math/tex">10^{-n}</script> for <script type="math/tex">n=0,1,2,\ldots</script> the
corresponding values of <script type="math/tex">\Delta</script> are:</p>

<p><label for="tab-der-1" class="margin-toggle"> ⊕</label><input type="checkbox" id="tab-der-1" class="margin-toggle" /><span class="marginnote">The effect of decreasing the step of approximation on
overall error for the modeled floating-point numbers with mantissa width = 6 </span></p>

<table>
  <thead>
    <tr>
      <th style="text-align: right"><script type="math/tex">n</script></th>
      <th style="text-align: right"><script type="math/tex">\Delta</script></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">0</td>
      <td style="text-align: right"><script type="math/tex">+0.166670\times10^{0}</script></td>
    </tr>
    <tr>
      <td style="text-align: right">-1</td>
      <td style="text-align: right"><script type="math/tex">+0.165000\times10^{-2}</script></td>
    </tr>
    <tr>
      <td style="text-align: right">-2 – -5</td>
      <td style="text-align: right"><script type="math/tex">+0.000000\times10^{0}</script></td>
    </tr>
    <tr>
      <td style="text-align: right">&lt; -6</td>
      <td style="text-align: right"><script type="math/tex">-0.100000\times10^{1}</script></td>
    </tr>
  </tbody>
</table>

<p>When the value of <script type="math/tex">h</script> becomes too small the difference <script type="math/tex">\exp{h}-\exp{(-h)}</script>
can no longer be captured by the limited precision numbers. Thus, the error
becomes <script type="math/tex">-1</script>. In real computer systems the promotion of mantissa from
underflow after subtraction may cause some garbage appear in the tail of the
mantissa. For example, using <code class="highlighter-rouge">SINGLE-FLOAT</code> values in Common Lisp,
<script type="math/tex">\exp{(10^{-4})}</script> and <script type="math/tex">\exp{(-10^{-4})}</script> evaluate to <script type="math/tex">1.0001</script> and <script type="math/tex">0.9999</script>
(with trailing zeros). Their difference, however is not <script type="math/tex">0.0002</script> but
<script type="math/tex">0.00020003319</script>. This extra garbage causes slightly faster deterioration of
the resulting error.</p>

<p><label for="tab-der-2" class="margin-toggle"> ⊕</label><input type="checkbox" id="tab-der-2" class="margin-toggle" /><span class="marginnote">The effect of the decreasing step of approximation on
overall error for <code class="highlighter-rouge">SINGLE-FLOAT</code> Common Lisp numbers </span></p>

<table>
  <thead>
    <tr>
      <th style="text-align: right"><script type="math/tex">n</script></th>
      <th style="text-align: right"><script type="math/tex">\Delta</script></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">0</td>
      <td style="text-align: right"><script type="math/tex">0.17520118\times10^{0}</script></td>
    </tr>
    <tr>
      <td style="text-align: right">-1</td>
      <td style="text-align: right"><script type="math/tex">0.16676188\times10^{-2}</script></td>
    </tr>
    <tr>
      <td style="text-align: right">-2</td>
      <td style="text-align: right"><script type="math/tex">0.1692772\times10^{-4}</script></td>
    </tr>
    <tr>
      <td style="text-align: right">-3</td>
      <td style="text-align: right"><script type="math/tex">0.1692772\times10^{-4}</script></td>
    </tr>
    <tr>
      <td style="text-align: right">-4</td>
      <td style="text-align: right"><script type="math/tex">0.16593933\times10^{-3}</script></td>
    </tr>
    <tr>
      <td style="text-align: right">-5</td>
      <td style="text-align: right"><script type="math/tex">0.13580322\times10^{-2}</script></td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td style="text-align: right">-8</td>
      <td style="text-align: right"><script type="math/tex">-0.1\times10^{1}</script></td>
    </tr>
  </tfoot>
</table>



    </article>
    <span class="print-footer">Practical and theoretical numbers - March 29, 2016 - Alexey Cherkaev (aka mobius-eng)</span>
    <footer>
  <hr class="slender">
  <ul class="footer-links">
    <li><a href="mailto:hate@spam.net"><span class="icon-mail"></span></a></li>    
    
      <li>
        <a href="//www.twitter.com/mobius_eng"><span class="icon-twitter"></span></a>
      </li>
    
      <li>
        <a href="//github.com/mobius-eng"><span class="icon-github"></span></a>
      </li>
      
  </ul>
<div class="credits">
<span>&copy; 2016 &nbsp;&nbsp;ALEXEY CHERKAEV (AKA MOBIUS-ENG)</span></br> <br>
<span>This site created with the <a href="//github.com/clayh53/tufte-jekyll">Tufte theme for math and programming </a> in <a href="//jekyllrb.com">Jekyll</a>.</span> 
</div>  
</footer>
  </body>
</html>
